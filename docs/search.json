[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Análisis de Datos in situ",
    "section": "",
    "text": "Tradicionalmente en el análisis de datos espaciales geoestadísticos la técnica de interpolación kriging ha sido la de mayor aplicación. Entre sus variantes el kriging con deriva externa (KDE) y el kriging regresión (RK) se han convertido en técnicas de referencia que explotan la autocorrelación espacial de los datos observados y la información aportada por covariables relacionadas a la respuesta.\nRecientemente, las técnicas de aprendizaje automático, como aquellas basadas en árboles de regresión, se han vuelto cada vez más populares para realizar interpolaciones espaciales dada su capacidad y flexibilidad para combinar numerosas capas de información. Sin embargo, estos métodos no fueron diseñados para contemplar la autocorrelación espacial en los datos. Hoy, existe una fuerte demanda de nuevas versiones de algoritmos de predicción espacial con la pericia de producir soluciones mejoradas por la inclusión en el modelo de la estructura de correlación espacial y/o temporal en los datos. En esta mesa de análisis de datos in situ se ilustra la aplicación de un algoritmo de Random Forest (RF) que incorpora la componente espacial en el ajuste del modelo predictivo. La misma es comprada con la aplicación clásica de Kriging y con el método Random Forest Kriging."
  },
  {
    "objectID": "slides_AA.html#interpolación-kriging",
    "href": "slides_AA.html#interpolación-kriging",
    "title": "GAB2022 Analisis in Situ",
    "section": "Interpolación Kriging",
    "text": "Interpolación Kriging\n\nKriging es considerado como el método de referencia para el análisis de datos geoestadísticos.\nToma un modelo estadístico integral como punto de partida y deriva en una predicción óptima.\nExplota la autocorrelación espacial en la variable de interés.\nProporciona una medida espacialmente explícita de la incertidumbre de la predicción."
  },
  {
    "objectID": "slides_AA.html#interpolación-kriging-1",
    "href": "slides_AA.html#interpolación-kriging-1",
    "title": "GAB2022 Analisis in Situ",
    "section": "Interpolación Kriging",
    "text": "Interpolación Kriging\n{fig-align=“center”, width=50%, height=50%}"
  },
  {
    "objectID": "slides_AA.html#interpolación-kriging-2",
    "href": "slides_AA.html#interpolación-kriging-2",
    "title": "GAB2022 Analisis in Situ",
    "section": "Interpolación Kriging",
    "text": "Interpolación Kriging\n{fig-align=“center”, width=50%, height=50%}"
  },
  {
    "objectID": "slides_AA.html#interpolación-kriging-3",
    "href": "slides_AA.html#interpolación-kriging-3",
    "title": "GAB2022 Analisis in Situ",
    "section": "Interpolación Kriging",
    "text": "Interpolación Kriging\n{fig-align=“center”, width=50%, height=50%}"
  },
  {
    "objectID": "slides_AA.html#modelación-tendencia",
    "href": "slides_AA.html#modelación-tendencia",
    "title": "GAB2022 Analisis in Situ",
    "section": "Modelación Tendencia",
    "text": "Modelación Tendencia"
  },
  {
    "objectID": "slides_AA.html#krigign-regresión",
    "href": "slides_AA.html#krigign-regresión",
    "title": "GAB2022 Analisis in Situ",
    "section": "Krigign Regresión",
    "text": "Krigign Regresión"
  },
  {
    "objectID": "slides_AA.html#interpolación-kriging-4",
    "href": "slides_AA.html#interpolación-kriging-4",
    "title": "GAB2022 Analisis in Situ",
    "section": "Interpolación Kriging",
    "text": "Interpolación Kriging\n\nKriging es considerado como el método de referencia para el análisis de datos geoestadísticos.\nToma un modelo estadístico integral como punto de partida y deriva en una predicción óptima.\nExplota la autocorrelación espacial en la variable de interés.\nProporciona una medida espacialmente explícita de la incertidumbre de la predicción.\n\n\n\n\n\n\n\n\n\n\nPuede ser computacionalmente exigente (tamaño muestra y grilla de predicción)\n\n\n\n\n\n\n\n\n\nRequiere asumir supuestos estadísticos (estacionariedad, normalidad, relaciones lineales entre las variables involucradas)\n\n\n\n\n\n\n\n\n\nNo es adecuado para incorporar la abundancia de información de covariables disponibles en la actualidad."
  },
  {
    "objectID": "slides_AA.html#algoritmos-de-aprendizaje-automático-aa",
    "href": "slides_AA.html#algoritmos-de-aprendizaje-automático-aa",
    "title": "GAB2022 Analisis in Situ",
    "section": "Algoritmos de Aprendizaje Automático (AA)",
    "text": "Algoritmos de Aprendizaje Automático (AA)\n\nEn los últimos años, se produjo un incrementó en el uso de técnicas de AA para la interpolación espacial.\nEstos métodos dependen en gran medida de la magnitud de la relación entre la variable dependiente y covariables\nUna de las principales ventajas es su gran flexibilidad al incorporar diferentes tipos de covariables.\n\n\n\n\n\n\n\n\n\n\nNo tienen en cuenta que las observaciones están georreferenciadas y pueden estar correlacionadas espacialmente.\n\n\n\n\n\n\n\n\n\nLa autocorrelación espacial de la variable respuesta es capturada completamente por las variables auxiliares."
  },
  {
    "objectID": "slides_AA.html#algoritmos-de-aprendizaje-automático-aa-1",
    "href": "slides_AA.html#algoritmos-de-aprendizaje-automático-aa-1",
    "title": "GAB2022 Analisis in Situ",
    "section": "Algoritmos de Aprendizaje Automático (AA)",
    "text": "Algoritmos de Aprendizaje Automático (AA)\nEnfoques para incluir información espacial en el análisis a partir de covariables espaciales:\n\nlongitud y latitud\ndistancias a esquinas y al centro del área a interpolar desde los sitios de muestreo\ndistancia de buffer desde los sitios de muestreo\n\n\n\nvalores de los sitios muestreados más cercanas a los sitios de predicción\n\n\nAlternativas:\n\nAA + Kriging\nRandom Forest geográficamente ponderado"
  },
  {
    "objectID": "slides_AA.html#interpolación-espacial-random-forest",
    "href": "slides_AA.html#interpolación-espacial-random-forest",
    "title": "GAB2022 Analisis in Situ",
    "section": "Interpolación Espacial Random Forest",
    "text": "Interpolación Espacial Random Forest\n\\[\\hat{z}_{(s_0)} = f \\big(x_{1} (s_{0}),\\dots,x_m(s_0),z(s_1),d_1,z(s_2),d_2,z(s_3),d_3,\\dots,z(s_n),d_n \\big)\\] Donde:\n\n\\(x_i(s_0) (i = 1,\\dots,m)\\) representa las covariables en el sitio \\(s_0\\)\n\\(s_i(s_0) (i = 1,\\dots,n)\\) es el valor de la \\(i-ésima\\) observación más cercana desde \\(s_0\\)\n\\(d_i=|s_i-s_0|\\)"
  },
  {
    "objectID": "Ej01_AA.html",
    "href": "Ej01_AA.html",
    "title": "Ejemplo 1: Mapeo del contenido de Arcilla a escala de lote",
    "section": "",
    "text": "En la agricultura de precisión el mapeo de variables de suelo y rendimiento para el estudio de la variabilidad espacial es crucial. A partir de la caracterización de esta es posible definir prácticas agronómicas que permitan realizar un manejo diferenciado del lote según las características de cada sitio.\nEn este caso de estudio se ilustra la implementación de técnicas de interpolación clásicas (basada en kriging) y del algoritmo Random Forest, con versiones que incorporan la información espacial en el análisis, para el mapeo del contenido de arcilla del suelo en un lote agrícola."
  },
  {
    "objectID": "Ej01_AA.html#datos",
    "href": "Ej01_AA.html#datos",
    "title": "Ejemplo 1: Mapeo del contenido de Arcilla a escala de lote",
    "section": "Datos",
    "text": "Datos\nLa base de datos proviene de un lote agrícola de 90 hectáreas, ubicados al sudeste pampeano de la provincia de Buenos Aires, Argentina. En este se realizaron mediciones intensivas de conductividad eléctrica aparente (CEa) a 30 y 90 cm de profundidad (CE30 y CE90), elevación (Elev) y profundidad de tosca (Pe). La medición de la CEa se realizó con un sensor Veris 3100, que utiliza el principio de la inducción electromagnética. Los datos de CEa fueron simultáneamente georreferenciados con un DGPS con una exactitud de medición submétrica. Los datos de elevación del terreno también se midieron con un DGPS y se procesaron para obtener una precisión vertical de entre 3 y 5 cm aproximadamente. Las mediciones de Pe se realizaron utilizando un penetrómetro hidráulico (Gidding) acoplado a un DGPS. Los datos de las variables medidas intensivamente fueron organizar los datos en una grilla común a todas las capas, de manera que cada celda de la grilla cuente con la información de su ubicación espacial y cada una de las variables medidas. Para el mapeo del contenido de Arcilla se tomaron 126 muestras de suelo a 20 cm de profundidad utilizando una grilla regular de 50 x100 m. La determinación de la distribución del tamaño de partículas se realizó utilizando el método de Robinson.\n\nLectura base de datos\n\n\nCarga paquetes y funciones\nlibrary(gstat)\nlibrary(spdep)\nlibrary(mapview)\nlibrary(tmap)\nlibrary(leaflet)\nlibrary(stars)\nlibrary(ggplot2)\nlibrary(caret)\nlibrary(randomForest)\nlibrary(nabor)\n\nsource(\"src/near.obs.R\")\n\n\n\ntmap_options(basemaps = c(\n  'Satelital' = leaflet::providers$Esri.WorldImagery,\n  'OSM' = leaflet::providers$OpenStreetMap))\n\n\n\ndatos <- st_read(\"data/Arcilla_Muestra.gpkg\")\nhead(datos)\n\ngrilla <- st_read(\"data/Arcilla_Grilla.gpkg\")\nhead(grilla)\n\n## Reading layer `Arcilla_Muestra' from data source \n##   `C:\\Users\\Pablo\\OneDrive\\Documentos\\Estadistica\\Cursos Dictados\\GAB2022_AnalisisInSitu\\data\\Arcilla_Muestra.gpkg' \n##   using driver `GPKG'\n## Simple feature collection with 126 features and 5 fields\n## Geometry type: POINT\n## Dimension:     XY\n## Bounding box:  xmin: 311980.9 ymin: 5800258 xmax: 313032.7 ymax: 5801350\n## Projected CRS: WGS 84 / UTM zone 21S\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nArcilla\nCE30\nCE90\nElev\nPe\ngeom\n\n\n\n\n32.1220\n19.78715\n23.19669\n161.3124\n-75.28120\nPOINT (312593.6 5801350)\n\n\n32.6840\n21.37011\n26.41949\n161.5158\n-80.60147\nPOINT (312666.7 5801282)\n\n\n33.8110\n24.46915\n24.38947\n161.8116\n-81.33350\nPOINT (312739.6 5801213)\n\n\n34.3246\n24.17774\n26.22092\n161.7234\n-57.99937\nPOINT (312812.8 5801145)\n\n\n33.2780\n24.63139\n24.54500\n161.2083\n-48.60929\nPOINT (312886.5 5801076)\n\n\n32.5577\n23.48269\n27.69627\n160.7578\n-69.24461\nPOINT (312959.8 5801007)\n\n\n\n\n\n\n## Reading layer `Arcilla_Grilla' from data source \n##   `C:\\Users\\Pablo\\OneDrive\\Documentos\\Estadistica\\Cursos Dictados\\GAB2022_AnalisisInSitu\\data\\Arcilla_Grilla.gpkg' \n##   using driver `GPKG'\n## Simple feature collection with 5982 features and 4 fields\n## Geometry type: POINT\n## Dimension:     XY\n## Bounding box:  xmin: 311962.8 ymin: 5800234 xmax: 313052.8 ymax: 5801364\n## Projected CRS: WGS 84 / UTM zone 21S\n\n\n\n\n\n\nCE30\nCE90\nElev\nPe\ngeom\n\n\n\n\n25.80810\n28.50741\n160.4142\n-78.07533\nPOINT (312432.8 5800234)\n\n\n26.19117\n28.14623\n160.4164\n-77.21150\nPOINT (312422.8 5800244)\n\n\n25.26266\n27.95664\n160.4286\n-78.65952\nPOINT (312432.8 5800244)\n\n\n26.28254\n27.56873\n160.4184\n-75.93873\nPOINT (312412.8 5800254)\n\n\n25.68631\n27.48603\n160.4275\n-76.89577\nPOINT (312422.8 5800254)\n\n\n24.82347\n27.26781\n160.4379\n-78.04122\nPOINT (312432.8 5800254)\n\n\n\n\n\n\n\n\nVisualización espacial de los datos\n\ntmap_mode('view')\n\n\n\n\ntm_shape(datos) +\n  tm_dots(col = 'Arcilla')\n\n\n\n\n\n\n\n\n\n\ntm_shape(grilla) +\n  tm_dots(col = 'Pe')\n\n\n\n\n\n\n\n\n\n\nKriging Ordinario\n\nAjuste de semivariogramas\n\nsemiva_exp <- variogram(Arcilla ~ 1 , datos)\n\nsemiva_teorico <-\n  fit.variogram(semiva_exp , vgm(c(\"Exp\", \"Sph\", \"Gau\")))\n\nvgLine <- cbind(variogramLine(semiva_teorico, maxdist = max(semiva_exp$dist)), id =\n                \"Semivariograma  Teórico\")\n        \ngrafico <-  ggplot(semiva_exp, aes(x = dist, y = gamma, color = id)) +\n  geom_line(data = vgLine) +\n  geom_point() +\n  labs(title = \"Semivariograma experimental y teorico ajustado\")  +\n  xlab(\"Distancia\") +\n  ylab(\"Semivarianza\")  +\n  scale_color_discrete(name = \"Semivariograma\",\n                       labels = c(\"Teórico\", \"Experimental\"))\n\ngrafico\n\n\n\n\n\n\nInterpolación Kriging\n\nkriging <-\n  krige(Arcilla ~ 1,\n        datos,\n        grilla,\n        model = semiva_teorico,\n        nmax = 25)\n\ngrilla$Kriging <- kriging$var1.pred\n\n## [using ordinary kriging]\n\n\n\n\nMapa predicción KO\n\ngrilla_rast <-\n  st_rasterize(grilla, dx = 10, dy = 10)\n\ntmap_mode('view')\nmapa_prediccion_Kriging <-\n  tm_shape(grilla_rast,\n           name = \"Kriging\") +\n  tm_raster(\n    col = \"Kriging\",\n    title = \"Arcilla (%) Kriging\",\n    style = \"fixed\",\n    palette = \"YlOrBr\",\n    contrast = c(0.1, 1),\n    breaks = c(30, 31, 32, 33, 34, 35, 36, 37)\n  ) +\n  tm_layout(legend.format = list(\n    scientific = TRUE,\n    format = \"f\",\n    digits = 0\n  ))\nmapa_prediccion_Kriging\n\n\n\n\n\n\n\n\nRandom Forest Kriging\n\nAjuste del RF\n\nfitControl <- trainControl(method = \"CV\", number = 10)\n\nset.seed(7)\ntrain_rf <- train(\n  Arcilla ~ .,\n  data = st_drop_geometry(datos) ,\n  method = \"rf\",\n  trControl = fitControl\n)\ntrain_rf\n\n## Random Forest \n## \n## 126 samples\n##   4 predictor\n## \n## No pre-processing\n## Resampling: Cross-Validated (10 fold) \n## Summary of sample sizes: 114, 114, 114, 113, 113, 113, ... \n## Resampling results across tuning parameters:\n## \n##   mtry  RMSE      Rsquared   MAE     \n##   2     1.421077  0.2506114  1.082240\n##   3     1.419343  0.2524498  1.079988\n##   4     1.417601  0.2562208  1.088827\n## \n## RMSE was used to select the optimal model using the smallest value.\n## The final value used for the model was mtry = 4.\n\n\n\n\nIncorporación de los residuos del RF a la base de datos\n\ndatos$residuosRF <-\n  datos$Arcilla - predict(train_rf, newdata = datos)\n\n\n\nAjuste de semivariograma experimetal y teorico a los residuos del RF\n\nsemiva_exp_residuos <- variogram(residuosRF ~ 1 , datos)\n\nsemiva_teorico_residuos <-\n  fit.variogram(semiva_exp_residuos , vgm(c(\"Exp\", \"Sph\", \"Gau\")))\nplot(semiva_exp_residuos , semiva_teorico_residuos)\n\n\n\n\n\n\nKriging sobre residuos del RF\n\nkgresRF <-\n  krige(residuosRF ~ 1,\n        datos,\n        grilla,\n        model = semiva_teorico_residuos,\n        nmax = 25)\n\n## [using ordinary kriging]\n\n\n\n\nPrediccion RF y RF-KO\n\ngrilla$RF <-\n  predict(train_rf, newdata = grilla)\n\ngrilla$RF_KO <-\n  predict(train_rf, newdata = grilla) + kgresRF$var1.pred\n\n\n\nMapa predicción RF\n\ngrilla_rast <-\n  st_rasterize(grilla, dx = 10, dy = 10)\n\nmapa_prediccionRF <-\n  tm_shape(grilla_rast,\n           name=\"RF\") +\n  tm_raster(\n    col = \"RF\",\n    title = \"Arcilla (%) RF\",\n    style = \"fixed\",\n    palette = \"YlOrBr\",\n    contrast = c(0.1, 1),\n    breaks = c(30, 31, 32, 33, 34, 35, 36, 37)\n  ) +\n  tm_layout(legend.format = list(\n    scientific = TRUE,\n    format = \"f\",\n    digits = 0\n  ))\n\nmapa_prediccionRF\n\n\n\n\n\n\n\nMapa predicción RF-KO\n\ngrilla_rast <-\n  st_rasterize(grilla, dx = 10, dy = 10)\n\nmapa_prediccionRF_KO <-\n  tm_shape(grilla_rast,\n           name = \"RF-KO\") +\n  tm_raster(\n    col = \"RF_KO\",\n    title = \"Arcilla (%) RF-KO\",\n    style = \"fixed\",\n    palette = \"YlOrBr\",\n    contrast = c(0.1, 1),\n    breaks = c(30, 31, 32, 33, 34, 35, 36, 37)\n  ) +\n  tm_layout(legend.format = list(\n    scientific = TRUE,\n    format = \"f\",\n    digits = 0\n  ))\n\nmapa_prediccionRF_KO\n\n\n\n\n\n\n\n\nInterpolación Espacial Random Forest (RFSI)\n\nGeneración de covariables basadas en distancia y valores vecinos\n\nnn_datos <- near.obs(\n  locations = as_Spatial(datos),\n  observations = as_Spatial(datos),\n  zcol = \"Arcilla\",\n  n.obs = 4,\n  idw = T\n)\ndatos <- cbind(datos[, -7], nn_datos)\n\n\n\nAjuste del RF\n\nset.seed(7)\ntrain_rfsi <- train(\n  Arcilla ~ .,\n  data = st_drop_geometry(datos) ,\n  method = \"rf\",\n  trControl = fitControl,\n  importance = T\n  \n)\ntrain_rfsi\n\n## Random Forest \n## \n## 126 samples\n##  13 predictor\n## \n## No pre-processing\n## Resampling: Cross-Validated (10 fold) \n## Summary of sample sizes: 114, 114, 114, 113, 113, 113, ... \n## Resampling results across tuning parameters:\n## \n##   mtry  RMSE       Rsquared   MAE      \n##    2    0.3111815  0.9815889  0.2514032\n##    7    0.2158811  0.9853193  0.1725439\n##   13    0.2286946  0.9831749  0.1818921\n## \n## RMSE was used to select the optimal model using the smallest value.\n## The final value used for the model was mtry = 7.\n\n\n\n\nImportancia de variables regresoras\n\nimportancia <- as.data.frame(importance(train_rfsi$finalModel))\nimportancia$Variable <- rownames(importancia)\n\nggplot(data = importancia, aes(\n  x = reorder(Variable, `%IncMSE`),\n  y = `%IncMSE`,\n  fill = `%IncMSE`\n)) +\n  labs(x = \"Variable\", title = \"Incremento de MSE (%)\") +\n  geom_col() +\n  coord_flip() +\n  theme_bw() +\n  theme(legend.position = \"bottom\")\n\n\n\n\n\n\nCalculo de los residuos del RFSI y ajuste de semivariograma experimetal\n\ndatos$residuosRFSI <-\n  datos$Arcilla - predict(train_rfsi, newdata = datos)\n\nsemiva_exp_residuos_rfsi <- variogram(residuosRFSI ~ 1 , datos)\nplot(semiva_exp_residuos_rfsi)\n\n\n\n\n\n\nPredicción RFSI\n\ngrilla_nn <-\n  near.obs(\n    locations = as_Spatial(grilla),\n    observations = as_Spatial(datos),\n    zcol = \"Arcilla\",\n    n.obs = 4,\n    idw = T\n  )\ngrilla <- cbind(grilla, grilla_nn)\n\ngrilla$RFSI <-\n  predict(train_rfsi, newdata = grilla)\n\n\n\nMapa predicción RFSI\n\ngrilla_rast <-\n  st_rasterize(grilla, dx = 10, dy = 10)\n\nmapa_prediccionRFSI <-\n  tm_shape(grilla_rast,\n           name = \"RFSI\") +\n  tm_raster(\n    col = \"RFSI\",\n    title = \"Arcilla (%) RFSI\",\n    style = \"fixed\",\n    palette = \"YlOrBr\",\n    contrast = c(0.1, 1),\n    breaks = c(30, 31, 32, 33, 34, 35, 36, 37)\n  ) +\n  tm_layout(legend.format = list(\n    scientific = TRUE,\n    format = \"f\",\n    digits = 0\n  ))\n\nmapa_prediccionRFSI\n\n\n\n\n\n\n\nMuestra + Mapas de predicción\n\nmapa_muestra <- tm_shape(datos,\n                         name = \"Muestra\") +\n  tm_dots(\n    \"Arcilla\",\n    title = \"Arcilla (%) Muestra\",\n    style = \"fixed\",\n    palette = \"YlOrBr\",\n    contrast = c(0.1, 1),\n    breaks = c(30, 31, 32, 33, 34, 35, 36, 37),\n    size = 0.1,\n    popup.vars = T,\n    popup.format = list(\n      digits = 1,\n      decimal.mark = \",\",\n      big.mark = \".\"\n    )\n  ) +\n  tm_layout(legend.format = list(scientific = TRUE, format = \"f\"))\n\nmapas <-\n  mapa_prediccion_Kriging + mapa_prediccionRF_KO + mapa_prediccionRF + mapa_prediccionRFSI + mapa_muestra\nmapas"
  },
  {
    "objectID": "Ej02_AA.html",
    "href": "Ej02_AA.html",
    "title": "Ejemplo 2: Mapeo del contenido de Zinc",
    "section": "",
    "text": "Este conjunto de datos proporciona la ubicación espacial de valores de concentraciones de metales pesados (cadmium, copper, lead, zinc), la elevación del terreno, el contenido de materia orgánica, tipo de suelo, frecuencia de inundación e un periodo de 10 años y distancia entre el punto muestreado y el rio Meuse. Los datos fueron recolectados mediante muestras compuestas de un área de 15 m x 15 m.\nSe ilustra el uso del método kriging ordinarios y del algoritmo RFSI, en un escenario donde se utiliza solo la información de la variable medida, sin incluir las covariables disponibles.\n\n\n\n\nCarga paquetes y funciones\nlibrary(sp)\nlibrary(geoR)\nlibrary(sf)\nlibrary(caret)\nlibrary(randomForest)\nlibrary(tmap)\nlibrary(gstat)\nlibrary(stars)\nsource(\"src/near.obs.R\")\n\ntmap_options(\n  basemaps = c(\n    'Satelital' = leaflet::providers$Esri.WorldImagery,\n    'OSM' = leaflet::providers$OpenStreetMap\n  )\n)\n\n\n\ndemo(meuse, echo = FALSE)\nhist(meuse$zinc, main=\"\")\n\n\n\ndatos_zinc <-\n  as.geodata(as.data.frame(meuse),\n             coords.col = 1:2,\n             data.col = 6)\n\n\n\n\n\n\n\nini.v <- c(var(log1p(datos_zinc$data)), 500)\nzinc.vgm <- likfit(datos_zinc,\n                   lambda = 0,\n                   ini = ini.v,\n                   cov.model =\n                     \"exponential\")\nzinc.vgm\n\n## kappa not used for the exponential correlation function\n## ---------------------------------------------------------------\n## likfit: likelihood maximisation using the function optim.\n## likfit: Use control() to pass additional\n##          arguments for the maximisation function.\n##         For further details see documentation for optim.\n## likfit: It is highly advisable to run this function several\n##         times with different initial values for the parameters.\n## likfit: WARNING: This step can be time demanding!\n## ---------------------------------------------------------------\n## likfit: end of numerical maximisation.\n## likfit: estimated model parameters:\n##       beta      tausq    sigmasq        phi \n## \"  6.1553\" \"  0.0164\" \"  0.5928\" \"500.0001\" \n## Practical Range with cor=0.05 for asymptotic range: 1497.866\n## \n## likfit: maximised log-likelihood = -1014\n\n\n\n\n\n\ngrilla_zinc <- meuse.grid@coords\nzinc.ok <-\n  krige.conv(datos_zinc,\n             locations = grilla_zinc,\n             krige = krige.control\n             (obj.m = zinc.vgm))\n\n## krige.conv: model with constant mean\n## krige.conv: performing the Box-Cox data transformation\n## krige.conv: back-transforming the predicted mean and variance\n## krige.conv: Kriging performed using global neighbourhood\n\n\n\n\n\n\n\n\n\nnn_datos_zinc <- near.obs(\n  locations = meuse,\n  observations = meuse,\n  zcol = \"zinc\",\n  n.obs = 10,\n  idw = F\n)\n\nmeuse_nn <- cbind(meuse[, -c(1:3, 5:13)], nn_datos_zinc)\nmeuse_nn\n\n## class       : SpatialPointsDataFrame \n## features    : 155 \n## extent      : 178605, 181390, 329714, 333611  (xmin, xmax, ymin, ymax)\n## crs         : +init=epsg:28992 \n## variables   : 21\n## names       : zinc,            dist1,            dist2,            dist3,            dist4,            dist5,            dist6,            dist7,            dist8,            dist9,           dist10, obs1, obs2, obs3, obs4, ... \n## min values  :  113, 43.9317652729776, 56.0446250768082, 85.7263086805912, 96.6747123088556, 117.923704148063, 126.589889011722, 131.320219311422, 146.768525236169, 148.060798322851, 185.043238190429,  113,  119,  119,  117, ... \n## max values  : 1839, 353.004249266209, 503.135170704653, 799.335974418767, 848.958185071562,  870.91790657903, 914.617406350874, 986.887024942572, 1013.12634947473, 1038.17146945965, 1043.98515315114, 1672, 1839, 1839, 1839, ...\n\n\n\n\n\n\nfitControl <- trainControl(method = \"CV\", number = 10)\nas.formula(paste(\"y ~ \", paste(names(meuse_nn), collapse = \"+\")))\n\nset.seed(7)\ntrain_rfsi_zinc <- train(\n  zinc ~ dist1 + dist2 + dist3 + dist4 + dist5 + dist6 + dist7 +\n    dist8 + dist9 + dist10 + obs1 + obs2 + obs3 + obs4 + obs5 +\n    obs6 + obs7 + obs8 + obs9 + obs10,\n  data = as.data.frame(meuse_nn) ,\n  method = \"rf\",\n  trControl = fitControl,\n  importance = T\n  \n)\ntrain_rfsi_zinc\n\n## y ~ zinc + dist1 + dist2 + dist3 + dist4 + dist5 + dist6 + dist7 + \n##     dist8 + dist9 + dist10 + obs1 + obs2 + obs3 + obs4 + obs5 + \n##     obs6 + obs7 + obs8 + obs9 + obs10\n## Random Forest \n## \n## 155 samples\n##  20 predictor\n## \n## No pre-processing\n## Resampling: Cross-Validated (10 fold) \n## Summary of sample sizes: 139, 139, 139, 139, 140, 141, ... \n## Resampling results across tuning parameters:\n## \n##   mtry  RMSE      Rsquared   MAE     \n##    2    259.5574  0.5678192  183.7801\n##   11    251.1136  0.5993428  172.1344\n##   20    259.5551  0.5790154  177.5460\n## \n## RMSE was used to select the optimal model using the smallest value.\n## The final value used for the model was mtry = 11.\n\n\n\n\n\n\nimportancia_zinc <-\n  as.data.frame(importance(train_rfsi_zinc$finalModel))\nimportancia_zinc$Variable <- rownames(importancia_zinc)\nhead(importancia_zinc)\n\nggplot(data = importancia_zinc, aes(\n  x = reorder(Variable, `%IncMSE`),\n  y = `%IncMSE`,\n  fill = `%IncMSE`\n)) +\n  labs(x = \"Variable\", title = \"Incremento de MSE (%)\") +\n  geom_col() +\n  coord_flip() +\n  theme_bw() +\n  theme(legend.position = \"bottom\")\n\n\n\n\n\n\n\n\n\n%IncMSE\nIncNodePurity\nVariable\n\n\n\n\ndist1\n2.5515291\n350521.2\ndist1\n\n\ndist2\n2.1945478\n480503.9\ndist2\n\n\ndist3\n7.1933649\n478014.8\ndist3\n\n\ndist4\n4.6694006\n372904.8\ndist4\n\n\ndist5\n0.8274903\n330880.7\ndist5\n\n\ndist6\n4.4517268\n233089.3\ndist6\n\n\n\n\n\n\n\n\n\n\ngrilla_nn_zinc <-\n  near.obs(\n    locations = meuse.grid,\n    observations = meuse_nn,\n    zcol = \"zinc\",\n    n.obs = 10,\n    idw = F\n  )\n\ngrilla_nn_zinc <- cbind(meuse.grid, grilla_nn_zinc)\n\ngrilla_nn_zinc$RFSI <-\n  predict(train_rfsi_zinc, newdata = grilla_nn_zinc)\n\n\n\n\n\ngrilla_nn_zinc$KO <- zinc.ok$predict\n\ngrilla_nn_zinc <- st_as_sf(grilla_nn_zinc)\ngrilla_nn_zinc_rast <-\n  st_rasterize(grilla_nn_zinc, dx = 40, dy = 40)\n\ntmap_mode('view')\n\nbreaks_custom <- pretty(c(grilla_nn_zinc_rast$KO,\n                          grilla_nn_zinc_rast$RFSI),\n                        n = 6)\n\n\nbreaks_custom <- quantile(c(grilla_nn_zinc_rast$KO,\n                            grilla_nn_zinc_rast$RFSI),\n                          c(0.2, 0.5, 0.8, 1),\n                          na.rm = TRUE)\n\n\nkriging_zinc <-\n  tm_basemap(\n    c(\n      Satelite = \"Esri.WorldImagery\",\n      Politico = \"Esri.WorldGrayCanvas\",\n      Topo = \"Esri.WorldTopoMap\"\n    )\n  ) +\n  tm_shape(grilla_nn_zinc_rast,\n           name = \"Kriging\") +\n  tm_raster(\n    col = \"KO\",\n    title = \"Zinc Kriging\",\n    style = \"cont\",\n    palette = \"YlOrBr\",\n    contrast = c(0.1, 1),\n    breaks = breaks_custom\n  ) +\n  tm_layout(legend.format = list(\n    scientific = TRUE,\n    format = \"f\",\n    digits = 0\n  ))\n\nkriging_zinc\n\n\n\n\n\n\nRFSI_zinc <-\n  tm_basemap(\n    c(\n      Satelite = \"Esri.WorldImagery\",\n      Politico = \"Esri.WorldGrayCanvas\",\n      Topo = \"Esri.WorldTopoMap\"\n    )\n  ) +\n  tm_shape(grilla_nn_zinc_rast,\n           name = \"RFSI\") +\n  tm_raster(\n    col = \"RFSI\",\n    title = \"Arcilla (%) RFSI\",\n    style = \"cont\",\n    palette = \"YlOrBr\",\n    contrast = c(0.1, 1),\n    breaks = breaks_custom\n  ) +\n  tm_layout(legend.format = list(\n    scientific = TRUE,\n    format = \"f\",\n    digits = 0\n  ))\n\nRFSI_zinc"
  },
  {
    "objectID": "slides.html",
    "href": "slides.html",
    "title": "GAB2022 Analisis in Situ",
    "section": "",
    "text": "Mostrar en una nueva pestaña"
  }
]